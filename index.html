<!DOCTYPE html>
<html dir="ltr" lang="pt-BR" style="--vh: 7.2px;" data-color-mode="auto" data-light-theme="light" data-dark-theme="dark">

  <head>

    <title>Capoeirando</title>

    <base href="/capoeirando.website/">
 
    <meta name="flutter-base-href" content="/capoeirando.website/"/>

    <meta charset="UTF-8">
    <meta content="IE=Edge" http-equiv="X-UA-Compatible"/>
    <meta name="description" content="O melhor app para divulgação de eventos"/>
    <meta name="author" content="Suebersson Montalvão"/>
    <!-- iOS meta tags & icons -->
    <meta name="apple-mobile-web-app-capable" content="yes"/>
    <meta name="apple-mobile-web-app-status-bar-style" content="black"/>
    <meta name="apple-mobile-web-app-title" content="Capoeirando Website"/>

    <!-- Metas adicionadas -->
    <meta http-equiv="Permissions-Policy" content="interest-cohort=(), user-id=()"/>
    <meta name="viewport" content="width=device-width, height=device-height, initial-scale=1.0, minimum-scale=1.0"/>
    <meta name="theme-color" content="#9E2A2B"/>
    <meta name="robots" content="max-image-preview:standard"/>
    <meta http-equiv="Content-Language" content="pt_BR"/>
    <meta property="og:image" content="./img/logo_144x144.png">
    
    <link rel="apple-touch-icon" type="image/png" href="./icons/Icon-192.png"/>
    
    <link rel="icon" type="image/png" href="./favicon.png"/>

    <link rel="manifest" href="./manifest.json"/>

    <!-- Carregar os estilos do arquivo styles.css-->
    <link rel="stylesheet" type="text/css" href="./styles.css"/>

    <script type="text/javascript">
      // The value below is injected by flutter build, do not touch.
      const serviceWorkerVersion = "1494000628";
    </script>

    <!-- This script adds the flutter initialization JS code -->
    <script src="./flutter.js" defer></script>

    <script type="text/javascript">
      // Tratamento caso a seja carregada uma url com duas barras no final da url
      // Sem isso corre o risco da web app quebrar o carregamento do flutter

      // console.log(window.clientInformation.userAgentData.mobile);
      // console.log('Platform name: ' + window.clientInformation.userAgentData.platform);
      // console.log('System name: ' + window.clientInformation.platform);

      // // Se o endereço de url termina com "//"
      // const invalidURL = new RegExp('.*//\$');
      // if (invalidURL.test(window.location.href)) {
      //   // window.location.href = document.querySelector("base[href]").href + 'page_not_found';
      //   window.location.replace(document.querySelector("base[href]").href + 'page_not_found');
      // }
      //
      // // Se o nome da rota inicial termina com "//"
      // if (window.location.href == `${document.querySelector("base[href]").href}/` ) {
      //   // window.location.href = document.querySelector("base[href]").href;
      //   window.location.replace(document.querySelector("base[href]").href);
      // }

      // Se o nome da rota começa e tem 2 ou mais ocorrencias de "/"
      const invalidPathName = new RegExp('^/{2,}');
      if (invalidPathName.test(window.location.pathname)) {
        window.location.replace(document.querySelector("base[href]").href);
      }

      // window.addEventListener("DOMContentLoaded", function(e) {
      //   console.log(e);
      // });

      // window.addEventListener('error', function(e) {
      //   console.log(e);
      // });

    </script>

  </head>

  <body>

    <!-- Carregar splashScreen nativa -->
    <img class="splashScreenLogo" src="./img/logo_144x144.png" height="100" width="100" style="visibility:visible" alt="Logo de splashScreen para Capoeirando Website"/>

    <script type="text/javascript">
      window.addEventListener('load', function(_) {
        // https://docs.flutter.dev/platform-integration/web/initialization
        // Download main.dart.js
        _flutter.loader.loadEntrypoint({
          serviceWorker: {
            serviceWorkerVersion: serviceWorkerVersion,
          },
          onEntrypointLoaded: async function(engineInitializer) {
            
            async function startApp(appRunner) {
              await appRunner.runApp();
              hideSplashScreen();
              // readParametersViaUrl();
            }

            try {

              //https://docs.flutter.dev/platform-integration/web/renderers
              // se o navegador for mobile, renderizar a web site usando html para 
              // carregar a página mais rápido

              engineInitializer.initializeEngine({
                renderer: window.navigator.userAgentData.mobile
                  ? "html"
                  : "canvaskit"
              }).then(startApp);

            } catch (error) {

              engineInitializer.initializeEngine().then(startApp);

            }

          }
        });
      });

      function hideSplashScreen() {
        // document.querySelector("img[class='splashScreenLogo']").hidden = true;
        document
          .querySelector('img[class="splashScreenLogo"]')
            .setAttribute("style", "display:none");
      }

      function readParametersViaUrl() {

        let params = new URLSearchParams(window.location.search);

        if (params.has('description')) {
          document
            .querySelector('meta[name="description"]')
              .setAttribute("content", params.get('description'));
        }

        if(params.has('title')){
          document.title = params.get('title');
        }

      }

    </script>
  
  </body>
  
</html>
